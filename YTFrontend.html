<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watch Together</title>
<meta name="referrer" content="no-referrer">
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #0b0b0b;
    color: #fff;
    font-family: system-ui, Segoe UI, Roboto;
  }
  .app {
    display: grid;
    grid-template-rows: 56px 1fr;
    height: 100%;
  }
  header {
    display: flex;
    align-items: center;
    padding: 0 16px;
    background: #111;
    border-bottom: 1px solid #222;
    font-weight: 600;
  }
  .status {
    margin-left: auto;
    font-size: 12px;
    opacity: .7;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
    background: black;
  }
</style>
</head>
<body>

<div class="app">
  <header>
    ðŸŽ¬ Watch Together
    <span class="status" id="status">loadingâ€¦</span>
  </header>

  <iframe
    id="player"
    allow="autoplay; fullscreen"
    sandbox="allow-scripts allow-presentation"
    referrerpolicy="no-referrer"
  ></iframe>
</div>

<script>
/* ======================
   CONFIG
====================== */

const VIDEO_ID = "hgYhws0AHcg";

/*
  IMPORTANT:
  - Invidious uses /embed/ID
  - Piped works best with /watch?v=ID
*/

const SOURCES = [
  { name: "Invidious", url: id => `https://vid.puffyan.us/embed/${id}` },
  { name: "Invidious", url: id => `https://inv.nadeko.net/embed/${id}` },
  { name: "Invidious", url: id => `https://invidious.jing.rocks/embed/${id}` },
  { name: "Piped",     url: id => `https://piped.video/watch?v=${id}` },
  { name: "Piped",     url: id => `https://piped.adminforge.de/watch?v=${id}` }
];

/* ======================
   LOGIC
====================== */

const iframe = document.getElementById("player");
const status = document.getElementById("status");

let index = 0;
let timeout = null;

function loadSource() {
  clearTimeout(timeout);

  if (index >= SOURCES.length) {
    status.textContent = "âŒ all sources failed";
    return;
  }

  const src = SOURCES[index++];
  status.textContent = `trying ${src.name}â€¦`;
  iframe.src = src.url(VIDEO_ID);

  // iframe doesnâ€™t expose media errors â†’ timeout heuristic
  timeout = setTimeout(loadSource, 7000);
}

// Success signal
iframe.addEventListener("load", () => {
  status.textContent = "â–¶ playing";
  clearTimeout(timeout);
});

// Hard error
iframe.addEventListener("error", loadSource);

// Start
loadSource();
</script>

</body>
</html>

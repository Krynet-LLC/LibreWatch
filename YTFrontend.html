<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watch Together (Invidious Popular)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { margin: 0; background: #0f0f0f; color: #eee; font-family: system-ui, sans-serif; }
header { display: flex; gap: .5rem; padding: 1rem; background: #181818; border-bottom: 1px solid #222; }
input, button { font-size: 1rem; padding: .6rem 1rem; border-radius: 9999px; border: none; }
input { flex: 1; background: #222; color: #eee; }
button { background: #bb86fc; color: #121212; font-weight: bold; cursor: pointer; }

.container { display: flex; height: calc(100vh - 72px); }
.video-frame { flex: 2; background: #000; }
.feed-frame { flex: 1; background: #111; overflow-y: auto; border-left: 1px solid #222; }

iframe { width: 100%; height: 100%; border: none; }
@media(max-width: 900px) {
  .container { flex-direction: column; }
  .video-frame { height: 50vh; }
  .feed-frame { height: 50vh; border-left: none; border-top: 1px solid #222; }
}
</style>
</head>

<body>

<header>
  <input id="searchInput" placeholder="Paste Invidious URL or YouTube video IDâ€¦" />
  <button id="searchBtn">Go</button>
</header>

<div class="container">
  <div class="video-frame">
    <iframe id="videoPlayer" src=""></iframe>
  </div>

  <div class="feed-frame">
    <iframe id="popularFeed" src="https://inv.nadeko.net/feed/popular"></iframe>
  </div>
</div>

<script>
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const videoPlayer = document.getElementById('videoPlayer');

// Extract video ID from any YouTube/Piped/Invidious URL
function extractID(value) {
  try {
    const url = new URL(value);
    return url.searchParams.get('v') || value.trim();
  } catch {
    return value.trim();
  }
}

// Load a video in the player iframe
function loadVideo(id) {
  if (!id) return;
  // Load video on the same Invidious instance
  videoPlayer.src = `https://inv.nadeko.net/watch?v=${encodeURIComponent(id)}`;
  location.hash = id;
}

searchBtn.onclick = () => {
  const value = searchInput.value.trim();
  if (!value) return;
  const id = extractID(value);
  loadVideo(id);
};

// Watch together via URL hash
function loadFromHash() {
  const hash = location.hash.replace('#', '');
  if (!hash) return;
  loadVideo(hash);
}

window.addEventListener('hashchange', loadFromHash);
loadFromHash();
</script>

</body>
</html>
